# Proyecto: EcoBot Home Control - Asistente Inteligente de Hogar
# Autor: Ignacio
# Descripci√≥n: Sistema de control y monitoreo de consumo energ√©tico del hogar.

import time
from datetime import datetime
import matplotlib.pyplot as plt  # üëà Agregado para el gr√°fico

# Tarifa el√©ctrica (colones por kWh en Costa Rica)
TARIFA = 140  

# Base de datos de dispositivos inteligentes
dispositivos = {
    "televisor": {"consumo": 0.12, "horas": 0, "estado": "apagado"},
    "computadora": {"consumo": 0.25, "horas": 0, "estado": "apagado"},
    "consola de videojuegos": {"consumo": 0.20, "horas": 0, "estado": "apagado"},
    "luces inteligentes": {"consumo": 0.02, "horas": 0, "estado": "apagado"},
    "lavadora inteligente": {"consumo": 0.80, "horas": 0, "estado": "apagado"},
    "termostato inteligente": {"consumo": 0.30, "horas": 0, "estado": "apagado"},
    "refrigeradora": {"consumo": 1.20, "horas": 24, "estado": "encendido"}
}

def eco_say(texto):
    """Simula voz de asistente."""
    print("EcoBot:", texto)
    time.sleep(0.6)

def menu():
    print("\n===== üì° MEN√ö PRINCIPAL - ECOBOT HOME CONTROL =====")
    print("1Ô∏è‚É£ Encender dispositivo")
    print("2Ô∏è‚É£ Apagar dispositivo")
    print("3Ô∏è‚É£ Registrar horas de uso")
    print("4Ô∏è‚É£ Ver reporte de consumo")
    print("5Ô∏è‚É£ Recomendaciones ecol√≥gicas")
    print("6Ô∏è‚É£ Historial de actividades")
    print("7Ô∏è‚É£ Salir")
    print("8Ô∏è‚É£ Ver gr√°fico de consumo\n")  # üëà Nueva opci√≥n

# Historial de acciones
historial = []

# Funciones principales
def encender_dispositivo():
    nombre = input("üîå Dispositivo a encender: ").lower()
    if nombre in dispositivos:
        dispositivos[nombre]["estado"] = "encendido"
        eco_say(f"{nombre.capitalize()} encendido correctamente.")
        historial.append((datetime.now(), f"Encendido {nombre}"))
    else:
        eco_say("No encontr√© ese dispositivo.")

def apagar_dispositivo():
    nombre = input("üí§ Dispositivo a apagar: ").lower()
    if nombre in dispositivos:
        dispositivos[nombre]["estado"] = "apagado"
        eco_say(f"{nombre.capitalize()} apagado.")
        historial.append((datetime.now(), f"Apagado {nombre}"))
    else:
        eco_say("No encontr√© ese dispositivo.")

def registrar_horas():
    eco_say("Registrando uso diario de dispositivos activos...")
    for nombre, datos in dispositivos.items():
        if datos["estado"] == "encendido":
            horas = float(input(f"‚è±Ô∏è ¬øCu√°ntas horas al d√≠a usas el {nombre}? "))
            dispositivos[nombre]["horas"] = horas
    eco_say("Registro completado con √©xito.")
    historial.append((datetime.now(), "Registro de horas actualizado."))

def reporte_consumo():
    eco_say("Generando reporte de consumo energ√©tico...")
    total_kwh = 0
    for nombre, datos in dispositivos.items():
        consumo = datos["consumo"] * datos["horas"]
        costo = consumo * TARIFA
        total_kwh += consumo
        estado = datos["estado"]
        print(f"{nombre.capitalize():25} {estado:10} {consumo:.2f} kWh | ‚Ç°{costo:.2f}")
    print("\n‚öôÔ∏è Total diario:", f"{total_kwh:.2f} kWh")
    print("üí∞ Costo diario:", f"‚Ç°{total_kwh * TARIFA:.2f}")
    print("üí∏ Costo mensual:", f"‚Ç°{total_kwh * TARIFA * 30:.2f}")
    historial.append((datetime.now(), "Reporte de consumo generado."))

def recomendaciones():
    eco_say("Analizando h√°bitos de consumo...")
    for nombre, datos in dispositivos.items():
        if datos["estado"] == "encendido" and datos["horas"] > 5:
            print(f"üî∏ Reduce el uso del {nombre}, lo mantienes encendido demasiado tiempo.")
        elif datos["consumo"] > 0.5 and datos["estado"] == "encendido":
            print(f"üîπ El {nombre} tiene un alto consumo, ap√°galo cuando no lo uses.")
    eco_say("Consejo: utiliza iluminaci√≥n LED, desconecta consolas en modo reposo y ajusta el termostato entre 22-24¬∞C.")
    historial.append((datetime.now(), "Recomendaciones generadas."))

def ver_historial():
    eco_say("Mostrando registro de actividades del sistema...")
    for fecha, accion in historial:
        print(f"{fecha.strftime('%d/%m %H:%M:%S')} ‚Üí {accion}")

# üëá Nueva funci√≥n: gr√°fico de consumo el√©ctrico
def grafico_consumo():
    eco_say("Creando gr√°fico de consumo por dispositivo...")
    nombres = []
    consumos = []

    for nombre, datos in dispositivos.items():
        consumo = datos["consumo"] * datos["horas"]
        if consumo > 0:
            nombres.append(nombre.capitalize())
            consumos.append(consumo)

    if not nombres:
        eco_say("No hay datos de consumo para mostrar.")
        return

    plt.figure(figsize=(9, 5))
    plt.bar(nombres, consumos)
    plt.title("Consumo El√©ctrico Diario por Dispositivo (kWh)")
    plt.ylabel("kWh consumidos")
    plt.xticks(rotation=30, ha='right')
    plt.grid(axis='y', linestyle='--', alpha=0.7)
    plt.tight_layout()
    plt.show()

    historial.append((datetime.now(), "Gr√°fico de consumo mostrado."))

# Programa principal
eco_say("Bienvenido a EcoBot Home Control üè†")
eco_say("Sistema listo para administrar tu hogar inteligente de manera ecol√≥gica.")

while True:
    menu()
    opcion = input("Selecciona una opci√≥n: ").lower()

    if opcion in ["1", "encender"]:
        encender_dispositivo()
    elif opcion in ["2", "apagar"]:
        apagar_dispositivo()
    elif opcion in ["3", "registrar"]:
        registrar_horas()
    elif opcion in ["4", "reporte"]:
        reporte_consumo()
    elif opcion in ["5", "recomendaciones"]:
        recomendaciones()
    elif opcion in ["6", "historial"]:
        ver_historial()
    elif opcion in ["7", "salir"]:
        eco_say("Guardando datos... apagando el sistema EcoBot. üåé Hasta pronto.")
        break
    elif opcion in ["8", "grafico", "gr√°fico"]:
        grafico_consumo()
    else:
        eco_say("Comando no reconocido. Intenta nuevamente.")
